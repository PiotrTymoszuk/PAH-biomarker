---
title: "Risk stratification and phenotyping in pulmonary arterial hypertension with machine learning algorithms and cluster analysis â€“ a long-term retrospective multicenter trial"
subtitle: "Figures and Tables"
author: "Innsbruck PAH registry"
date: "`r format(Sys.time(), '%Y-%m-%d')`"

output: 
  bookdown::word_document2:   
    reference_docx: ms_template.docx
    
bibliography: pah_biblio.bib
csl: JGIM.csl

header-includes:
  \usepackage{longtable}
  \usepackage{tabu}
  \usepackage{caption}
  \usepackage{makecell}
  \usepackage{pdflscape}
  \usepackage{array}
  \usepackage{booktabs}
  \usepackage{threeparttable}
  \usepackage{threeparttablex}
  \usepackage{wrapfig}
  \usepackage{multirow}
  \usepackage[normalem]{ulem}
  \usepackage{colortbl}
  \usepackage{xcolor}
  \usepackage{float} \floatplacement{figure}{H} \floatplacement{table}{H}
  \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{S\arabic{table}}       \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
---

```{r, setup, include = FALSE}

library(bookdown)

knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      dev = "cairo_pdf")

flextable::set_flextable_defaults(font.family = 'Cambria', 
                                  font.size = 10)


```

\newpage

# Tables

```{r tab-cohort, tab.cap = 'Characteristic of the study cohorts.'}

paper_tables$cohort_features %>% 
  flextable %>% 
  width(1, width = 2.8, unit = 'cm') %>% 
  width(2:3, width = 4.6, unit = 'cm') %>% 
  width(4, width = 2.5, unit = 'cm') %>% 
  width(5, width = 2, unit = 'cm') %>% 
  footnote(c(2, 8:10), 4, part = 'body', value = as_paragraph('Mann-Whitney U test.'), ref_symbols = 'a') %>% 
  footnote(c(2, 8:10), 5, part = 'body', value = as_paragraph('r effect size statistic.'), ref_symbols = 'b') %>% 
  footnote(c(3:7, 11), 4, part = 'body', value = as_paragraph('\u03C7\u00B2 test.'), ref_symbols = 'c') %>% 
  footnote(c(3:7, 11), 5, part = 'body', value = as_paragraph('Cramer V effect size statistic.'), ref_symbols = 'd') %>% 
  footnote(12, 4, part = 'body', value = as_paragraph('Mentel-Haenszel test'), ref_symbols = 'e') %>% 
  theme_vanilla
  
```

\newpage

# Figures {#sec:figures}

```{r fig-strobe, fig.width = mm_inch(paper_figures$strobe$w), fig.height = mm_inch(paper_figures$strobe$h), fig.cap = 'Flow diagram of the study analysis inclusion process.'}

paper_figures$strobe$plot

```

__Figure \@ref(fig:fig-strobe). Flow diagram of the study analysis inclusion process.__

PH: pulmonary hypertension; RHC: right heart catheterization; CTEPH: chronic thromboembolic pulmonary hypertension.

\newpage

```{r fig-elanet, fig.width = mm_inch(paper_figures$elanet$w), fig.height = mm_inch(paper_figures$elanet$h), fig.cap = 'Multi-parameter survival modeling.'}

paper_figures$elanet$plot

```

__Figure \@ref(fig:fig-elanet). Multi-parameter survival modeling.__

The elastic net multi-parameter Cox regression model with the set of `r nrow(pah_study$mod_variables)` (__Supplementary Table S1__) independent variables and overall survival as a response was developed in the training Innsbruck cohort. Numeric independent variables were median centered and their first and second order terms included in the model. Numbers of complete observations and mortality is indicated in __B__.

__(A)__ Non-zero model coefficients represented as hazard ratios (HR). Plot points are labeled with the HR values.

__(B)__ Association of the elastic net model linear predictor score with overall survival in the training IBK and test Linz/Vienna (LZ/W) cohort. Actual and modeled survival are presented in Kaplan-Meier plots. $R^2$ and concordance index (C) with 95$\%$ confidence intervals are shown in the plot captions.

CI: cardiac index; NT-pro-BNP: N terminal pro brain natriuretic peptide; RDW: red blood cell distribution width; PVR: pulmonary vascular resistance; RAA: right atrial area; SMWD: six minute walking distance.

\newpage

```{r fig-elanet-calibration, fig.width = mm_inch(paper_figures$elanet_calibration$w), fig.height = mm_inch(paper_figures$elanet_calibration$h), fig.cap = 'Elastic net model linear prediction score and overall survival.'}

paper_figures$elanet_calibration$plot

```

__Figure \@ref(fig:fig-elanet-calibration). Elastic net model linear prediction score and overall survival.__

The elastic net multi-parameter Cox model was developed in the training Innsbruck (IBK) cohort (__Figure \@ref(fig:fig-elanet)__). Association of overall survival with the elastic net model linear prediction score in the training IBK and test Linz/Vienna (LZ/W) cohort was assessed by Kaplan-Meier analysis. Significance of the survival differences in the study participants stratified by the linear predictor score tertiles (T1: 0 - 33, T2: 34 - 66, T3: 66 - 100 percentile) was determined by log-rank test adjusted for multiple testing with Benjamini-Hochberg method. P values are shown in the plots, numbers of complete observations and mortality are indicated under the plots.

\newpage

```{r fig-part-clust, fig.width = mm_inch(paper_figures$part_clust$w), fig.height = mm_inch(paper_figures$part_clust$h), fig.cap = 'Clustering of the study participants.'}

paper_figures$part_clust$plot

```

__Figure \@ref(fig:fig-part-clust). Clustering of the study participants.__

Clustering of the training Innsbruck (IBK) cohort participants in respect to the survival-associated factors identified by elastic-net modeling (__Figure \@ref(fig:fig-elanet)__) was investigated by PAM (partition around medoids) algorithm and cosine distance measure. Numeric clustering features were median centered prior to the clustering. Cluster assignment in the training Linz/Vienna cohort (LZ/W) was done with the k-nearest neighbor classification technique. Numbers of individuals assigned to the clusters are presented in __B__.

__(A)__ Cluster assignment overlaid on the 3-dimensional principal analysis (PCA) score plots. The first two principal components (PC) are presented, percentages of variance associated with the components are indicated in the plot axes.

__(B)__ Differences in the clustering features between the participant clusters presented in violin plots. Points represent single observations.

CI: cardiac index; NT-pro-BNP: N terminal pro brain natriuretic peptide; RDW: red blood cell distribution width; PVR: pulmonary vascular resistance; RAA: right atrial area; SMWD: six minute walking distance.

\newpage

```{r fig-cluster-risk, fig.width = mm_inch(paper_figures$cluster_risk$w), fig.height = mm_inch(paper_figures$cluster_risk$h), fig.cap = 'Risk assessment and survival differences in the participant clusters.'}

paper_figures$cluster_risk$plot

```

__Figure \@ref(fig:fig-cluster-risk). Risk assessment and survival differences in the participant clusters.__

Risk assessment scoring and overall survival was compared between the study participant clusters (__Figure \@ref(fig:fig-part-clust)__, __Supplementary Figure S3__) with Mann-Whitney and Mentel-Haenszel test, respectively. P values were adjusted for multiple testing with Benjamini-Hochberg method. Numbers of individuals assigned to the clusters are presented in __F__.

__(A - E)__ Risk assessment score values presented in violin plots. Points represent single observations, diamonds with whiskers indicate medians with interquartile ranges. P values are presented in plot captions.

__(F)__ Differences in overall survival in the participant clusters visualized in Kaplan-Meier plots. P values are indicated in the plots.

FPHR: French pulmonary hypertension register; SPAHR: Swedish pulmonary arterial hypertension register; COMPERA: comparative, prospective registry of newly initiated therapies for pulmonary hypertension; mRASP: modified risk assessment score of PAH.

\newpage

```{r fig-summary, fig.width = mm_inch(paper_figures$summary$w), fig.height = mm_inch(paper_figures$summary$h), fig.cap = 'Summary of the analysis results.'}

paper_figures$summary$plot

```

__Figure \@ref(fig:fig-summary). Summary of the analysis results.__

RHC: right heart catheterization; CI: cardiac index; NT-pro-BNP: N terminal pro brain natriuretic peptide; RDW: red blood cell distribution width; PVR: pulmonary vascular resistance; RAA: right atrial area; SMWD: six minute walking distance.

\newpage